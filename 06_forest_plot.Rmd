---
title: "06_forest_plot"
output: html_document
date: '2022-06-07'
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Library
```{r}
library(dplyr)
library(formr)
library(ggplot2)
library(psych)
library(effsize)

library(forestplot)
```


# Create forest plot for each outcome section with effect sizes and 95% CIs

## Preferred relationship options
```{r}
base_data <- tibble(mean  = c(-0.67, 1.12, -0.46, 0.20, 0.57, 0.61, -0.77), 
                    lower = c(-0.83, 0.93, -0.61, 0.05, 0.41, 0.45, -0.94),
                    upper = c(-0.51, 1.32, -0.31, 0.35, 0.73, 0.76, -0.61),
                    Preferred_relationship_options = c("Sexual, non-romantic", "Non-sexual, romantic", "Monogamous", "Non-monogamous", "Alternative committed", "Being non-partnered", "Becoming a parent"),
                    d = c("-0.67", "1.12", "-0.46", "0.20", "0.57", "0.61", "-0.77"))

summary <- tibble(mean  = 0.09,
                  lower = 0,
                  upper = 0.5,
                  Preferred_relationship_options = "Summary",
                  d = "0.09",
                  summary = TRUE)

header <- tibble(Preferred_relationship_options = c("", "Preferred relationship options"),
                d = c("", "d"),
                 summary = TRUE)

empty_row <- tibble(mean = NA_real_)

preferred_relationship_options <- bind_rows(header,
                                base_data,
                                empty_row,
                                summary)



preferred_relationship_options  %>% 
  forestplot(labeltext = c(Preferred_relationship_options, d), 
             graph.pos = 3,
              clip = c(-1,2),
             lty.ci = 2,
             boxsize = .25,
              is.summary = summary,
              grid = structure(c(-.1, .1), 
                              gp = gpar(lty = 2, col = "#CCCCFF")), 
              xticks = c(-.1, -0.5, -0.1,0, .1, .5, 1),
             col = fpColors(box = "royalblue",
                            line = "black",
                            summary = "royalblue"),
             xlab = "Effect size (Cohen's d)")
```


## Partner preferences
```{r}
base_data_prefs <- tibble(mean  = c(-0.37, -0.52, -0.66, -0.16, -0.21, 0.01), 
                    lower = c(-0.51, -0.66, -0.81, -0.30, -0.35, -0.12),
                    upper = c(-0.24, -0.37, -0.51, -0.02, -0.08, 0.15),
                    Partner_preferences = c("Confident-assertive", "Attractive", "Sexually experienced", "Kind-supportive", "Financially secure-successful", "Educated-intelligent"),
                    d = c("-0.37", "-0.52", "-0.66", "0.16", "-0.21", "0.01"))

round(mean(base_data_prefs$mean),2) # mean of means

summary <- tibble(mean  = -0.32,
                  lower = -.5,
                  upper = 0.5,
                  Partner_preferences = "Summary",
                  d = "-0.32",
                  summary = TRUE)

header <- tibble(Partner_preferences = c("", "Partner preferences"),
                d = c("", "d"),
                 summary = TRUE)

empty_row <- tibble(mean = NA_real_)

partner_preferences <- bind_rows(header,
                                base_data_prefs,
                                empty_row,
                                summary)



partner_preferences %>% 
  forestplot(labeltext = c(Partner_preferences, d), 
             graph.pos = 3,
              clip = c(-1,2),
             lty.ci = 2,
             boxsize = .25,
              is.summary = summary,
              grid = structure(c(-.1, .1), 
                              gp = gpar(lty = 2, col = "#CCCCFF")), 
             xticks = c(-.1, -0.5, -0.1,0, .1, .5, 1),
             col = fpColors(box = "royalblue",
                            line = "black",
                            summary = "royalblue"))
```


## Self-ratings
```{r}
base_data_self <- tibble(mean  = c(-0.43, -0.49, -0.65, -0.40, -0.45, -0.17), 
                    lower = c(-0.57, -0.63, -0.79, -0.54, -0.60, -0.31),
                    upper = c(-0.29, -0.34, -0.52, -0.25, -0.31, -0.04),
                    self_ratings = c("Confident-assertive", "Attractive", "Sexually experienced", "Kind-supportive", "Financially secure-successful", "Educated-intelligent"),
                    d = c("-0.43", "-0.49", "-0.65", "-0.40", "-0.45", "-0.17"))

round(mean(base_data_self$mean),2) # mean of means


header <- tibble(self_ratings = c("", "Self-ratings"),
                d = c("", "d"),
                 summary = TRUE)


self_ratings <- bind_rows(header,
                                base_data_self)



self_ratings %>% 
  forestplot(labeltext = c(self_ratings, d), 
             graph.pos = 3,
              clip = c(-2,2),
             lty.ci = 2,
             boxsize = .25,
             ## Preferred relationship options
```{r}
base_data <- tibble(mean  = c(-0.67, 1.12, -0.46, 0.20, 0.57, 0.61, -0.77), 
                    lower = c(-0.83, 0.93, -0.61, 0.05, 0.41, 0.45, -0.94),
                    upper = c(-0.51, 1.32, -0.31, 0.35, 0.73, 0.76, -0.61),
                    Preferred_relationship_options = c("Sexual, non-romantic", "Non-sexual, romantic", "Monogamous", "Non-monogamous", "Alternative committed", "Being non-partnered", "Becoming a parent"),
                    d = c("-0.67", "1.12", "-0.46", "0.20", "0.57", "0.61", "-0.77"))

summary <- tibble(mean  = 0.09,
                  lower = 0,
                  upper = 0.5,
                  Preferred_relationship_options = "Summary",
                  d = "0.09",
                  summary = TRUE)

header <- tibble(Preferred_relationship_options = c("", "Preferred relationship options"),
                d = c("", "d"),
                 summary = TRUE)

empty_row <- tibble(mean = NA_real_)

preferred_relationship_options <- bind_rows(header,
                                base_data,
                                empty_row,
                                summary)



preferred_relationship_options  %>% 
  forestplot(labeltext = c(Preferred_relationship_options, d), 
             graph.pos = 3,
              clip = c(-1,2),
             lty.ci = 2,
             boxsize = .25,
              is.summary = summary,
              grid = structure(c(-.1, .1), 
                              gp = gpar(lty = 2, col = "#CCCCFF")), 
              xticks = c(-.1, -0.5, -0.1,0, .1, .5, 1),
             col = fpColors(box = "royalblue",
                            line = "black",
                            summary = "royalblue"))
```


## Partner preferences
```{r}
base_data_prefs <- tibble(mean  = c(-0.37, -0.52, -0.66, -0.16, -0.21, 0.01), 
                    lower = c(-0.51, -0.66, -0.81, -0.30, -0.35, -0.12),
                    upper = c(-0.24, -0.37, -0.51, -0.02, -0.08, 0.15),
                    Partner_preferences = c("Confident-assertive", "Attractive", "Sexually experienced", "Kind-supportive", "Financially secure-successful", "Educated-intelligent"),
                    d = c("-0.37", "-0.52", "-0.66", "0.16", "-0.21", "0.01"))

round(mean(base_data_prefs$mean),2) # mean of means

summary <- tibble(mean  = -0.32,
                  lower = -.5,
                  upper = 0.5,
                  Partner_preferences = "Summary",
                  d = "-0.32",
                  summary = TRUE)

header <- tibble(Partner_preferences = c("", "Partner preferences"),
                d = c("", "d"),
                 summary = TRUE)

empty_row <- tibble(mean = NA_real_)

partner_preferences <- bind_rows(header,
                                base_data_prefs,
                                empty_row,
                                summary)



partner_preferences %>% 
  forestplot(labeltext = c(Partner_preferences, d), 
             graph.pos = 3,
              clip = c(-1,2),
             lty.ci = 2,
             boxsize = .25,
              is.summary = summary,
              grid = structure(c(-.1, .1), 
                              gp = gpar(lty = 2, col = "#CCCCFF")), 
             xticks = c(-.1, -0.5, -0.1,0, .1, .5, 1),
             col = fpColors(box = "royalblue",
                            line = "black",
                            summary = "royalblue"))
```


## Self-ratings
```{r}
base_data_self <- tibble(mean  = c(-0.43, -0.49, -0.65, -0.40, -0.45, -0.17), 
                    lower = c(-0.57, -0.63, -0.79, -0.54, -0.60, -0.31),
                    upper = c(-0.29, -0.34, -0.52, -0.25, -0.31, -0.04),
                    self_ratings = c("Confident-assertive", "Attractive", "Sexually experienced", "Kind-supportive", "Financially secure-successful", "Educated-intelligent"),
                    d = c("-0.43", "-0.49", "-0.65", "-0.40", "-0.45", "-0.17"))

round(mean(base_data_self$mean),2) # mean of means

summary <- tibble(mean  = -0.43,
                  lower = -.5,
                  upper = 0.5,
                  self_ratings = "Summary",
                  d = "-0.43",
                  summary = TRUE)

header <- tibble(self_ratings = c("", "Self-ratings"),
                d = c("", "d"),
                 summary = TRUE)

empty_row <- tibble(mean = NA_real_)

self_ratings <- bind_rows(header,
                                base_data_self,
                                empty_row,
                                summary)



self_ratings %>% 
  forestplot(labeltext = c(self_ratings, d), 
             graph.pos = 3,
              clip = c(-2,2),
             lty.ci = 2,
             boxsize = .25,
              is.summary = summary,
              grid = structure(c(-.26, .26), 
                              gp = gpar(lty = 2, col = "#CCCCFF")), 
             xticks = c(-1, -0.5,-0.26, 0, 0.26, .5, 1),
             col = fpColors(box = "royalblue",
                            line = "black",
                            summary = "royalblue"))

```

# ohne Summary
```{r}
## Preferred relationship options
```{r}
base_data_rel <- tibble(mean  = c(-0.67, 1.12, -0.46, 0.20, 0.57, 0.61, -0.77), 
                    lower = c(-0.83, 0.93, -0.61, 0.05, 0.41, 0.45, -0.94),
                    upper = c(-0.51, 1.32, -0.31, 0.35, 0.73, 0.76, -0.61),
                    Preferred_relationship_options = c("Sexual, non-romantic", "Non-sexual, romantic", "Monogamous", "Non-monogamous", "Alternative committed", "Being non-partnered", "Becoming a parent"),
                    d = c("-0.67", "1.12", "-0.46", "0.20", "0.57", "0.61", "-0.77"))


header_rel <- tibble(Preferred_relationship_options = c("", "Outcome"),
                d = c("", "d"),
                 summary = TRUE)

empty_row <- tibble(mean = NA_real_)

preferred_relationship_options <- bind_rows(header_rel,
                                base_data_rel,
                                empty_row)



plot_preferred_relationship_options = preferred_relationship_options  %>% 
  forestplot(labeltext = c(Preferred_relationship_options, d), 
             graph.pos = 3,
              clip = c(-1,2),
             lty.ci = 2,
             boxsize = .25,
              is.summary = summary,
              grid = structure(c(-.26, .26), 
                              gp = gpar(lty = 2, col = "darkblue")), 
              xticks = c(-1.5,-1, -0.5, -0.26,0, .26, .5, 1, 1.5),
             xlab = "Effect size (Cohen's d)",
             txt_gp = fpTxtGp(ticks=gpar(cex=.75), xlab=gpar(cex=1)),
             col = fpColors(box = "royalblue",
                            line = "black",
                            summary = "royalblue"),
             title = "Preferred Relationship Options (n = 646)",
             graphwidth = unit(150, "mm"))

plot_preferred_relationship_options
```


## Partner preferences
```{r}
base_data_prefs <- tibble(mean  = c(-0.37, -0.52, -0.66, -0.16, -0.21, 0.01), 
                    lower = c(-0.51, -0.66, -0.81, -0.30, -0.35, -0.12),
                    upper = c(-0.24, -0.37, -0.51, -0.02, -0.08, 0.15),
                    Partner_preferences = c("Confident-assertive", "Attractive", "Sexually experienced", "Kind-supportive", "Financially secure-successful", "Educated-intelligent"),
                    d = c("-0.37", "-0.52", "-0.66", "-0.16", "-0.21", "0.01"))


header_prefs <- tibble(Partner_preferences = c("", "Outcome"),
                d = c("", "d"),
                 summary = TRUE)


partner_preferences_prefs <- bind_rows(header_prefs,
                                base_data_prefs)



plot_partner_preferences = partner_preferences %>% 
  forestplot(labeltext = c(Partner_preferences, d), 
             graph.pos = 3,
              clip = c(-2,2),
             lty.ci = 2,
             boxsize = .25,
              is.summary = summary,
              grid = structure(c(-.26, .26), 
                              gp = gpar(lty = 2, col = "darkblue")), 
             xticks = c(-1.5,-1, -0.5, -0.26,0, .26, .5, 1, 1.5),
             xlab = "Effect size (Cohen's d)",
             txt_gp = fpTxtGp(ticks=gpar(cex=.75), xlab = gpar(cex=1)),
             col = fpColors(box = "royalblue",
                            line = "black",
                            summary = "royalblue"),
             title = "Ideal Long-Term Partner Preferences (n = 780)",
             graphwidth = unit(150, "mm"))

plot_partner_preferences

```


## Self-ratings
```{r}
base_data_self <- tibble(mean  = c(-0.43, -0.49, -0.65, -0.40, -0.45, -0.17), 
                    lower = c(-0.57, -0.63, -0.79, -0.54, -0.60, -0.31),
                    upper = c(-0.29, -0.34, -0.52, -0.25, -0.31, -0.04),
                    self_ratings = c("Confident-assertive", "Attractive", "Sexually experienced", "Kind-supportive", "Financially secure-successful", "Educated-intelligent"),
                    d = c("-0.43", "-0.49", "-0.65", "-0.40", "-0.45", "-0.17"))

header_self <- tibble(self_ratings = c("", "Outcome"),
                d = c("", "d"),
                 summary = TRUE)

self_ratings <- bind_rows(header_self,
                          base_data_self)

plot_self_ratings = self_ratings %>% 
  forestplot(labeltext = c(self_ratings, d), 
             graph.pos = 3,
              clip = c(-2,2),
             lty.ci = 2,
             boxsize = .25,
              is.summary = summary,
              grid = structure(c(-.26, .26), 
                              gp = gpar(lty = 2, col = "darkblue")), 
             xticks = c(-1.5,-1, -0.5, -0.26,0, .26, .5, 1, 1.5),
             xlab = "Effect size (Cohen's d)",
             txt_gp = fpTxtGp(ticks=gpar(cex=.75), xlab=gpar(cex=1)),
             col = fpColors(box = "royalblue",
                            line = "black",
                            summary = "royalblue"),
             title = "Self-Ratings (n = 772)",
             graphwidth = unit(150, "mm"))

plot_self_ratings

```


```{r}
library(ggplotify)
library(patchwork)

p1 <- grid2grob(print(plot_self_ratings))
p2 <- grid2grob(print(plot_partner_preferences))
p_both <- wrap_elements(p1) / wrap_elements(p2)
p_both

p3 <- grid2grob(print(plot_preferred_relationship_options))
p_three <- wrap_elements(p_both) / wrap_elements(p3)
p_three
```



